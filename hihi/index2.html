<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      }

      img {
        display: block;
        max-width: 100%;
      }

      button {
        font-family: inherit;
      }

      .movies {
        display: grid;
        margin-top: 3rem;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1rem;
        justify-content: center;
      }

      .movies .movie__name {
        font-size: 1rem;
      }

      .movies .movie__origin-name {
        font-size: 0.875rem;
      }

      .movies .movie__img {
        overflow: hidden;
        border-radius: 8px;
      }

      .movie .movie__img img:hover {
        transform: scale(1.05);
      }

      .movies .movie__img img {
        height: 100%;
        object-fit: cover;
        transition: all 0.3s;
        aspect-ratio: 2/3;
      }

      .movie {
        display: grid;
        grid-template-rows: subgrid;
        grid-row: span 3;
        text-align: center;
        gap: 0;
      }

      .pagination {
        display: flex;
        justify-content: center;
        padding: 1rem;
        align-items: flex-end;
        gap: 1rem;
      }

      button {
        padding: 12px 16px;
        cursor: pointer;
        border-radius: 8px;
        border: none;
        transition: all 0.3s;
      }
      button:hover {
        background-color: rgba(0, 0, 0, 0.266);
      }

      .page-info {
        border-radius: 8px;
        border: 1px solid black;
        padding: 0.5rem;
      }

      .page-input {
        padding: 0.25rem 0.5rem;
        text-align: end;
        max-width: 100px;
      }

      .wrapper {
        padding-inline: 1.5rem;
        margin: 0 auto;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 50px auto;
        grid-column: 1 / -1;
      }

      .error-msg {
        text-align: center;
        color: red;
        grid-column: 1 / -1;
        padding: 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body>
    <div class="wrapper">
      <div class="movies"></div>
      <div class="pagination">
        <button class="btn-prev" disabled>Trang trước</button>
        <div class="page-info">
          <span>Trang</span>
          <input type="number" class="page-input" value="1" min="1" />
          <span class="total-pages"> /...</span>
        </div>
        <button class="btn-next">Trang sau</button>
      </div>
    </div>
    x
    <script>
      const container = document.querySelector(".movies");
      const pageInput = document.querySelector(".page-input");
      const totalPages = document.querySelector(".total-pages");
      const btnPrev = document.querySelector(".btn-prev");
      const btnNext = document.querySelector(".btn-next");

      let totalPagesCount = 1;
      const params = {
        page: 1,
        limit: 24,
      };

      const toggleControls = (isDisabled) => {
        btnPrev.disabled = isDisabled;
        btnNext.disabled = isDisabled;
        pageInput.disabled = isDisabled;
        if (!isDisabled) {
          btnPrev.disabled = params.page <= 1;
          btnNext.disabled = params.page >= totalPagesCount;
        }
      };
      const fetchMovies = async (slug, params = {}) => {
        const baseUrl = `https://ophim1.com/v1/api/danh-sach/${slug}`;
        const url = new URL(baseUrl);
        Object.keys(params).forEach((key) => {
          if (params[key] !== undefined && params[key] !== null) {
            url.searchParams.append(key, params[key]);
          }
        });
        try {
          container.innerHTML = '<div class="spinner"></div>';
          toggleControls(true); // Disable buttons
          const response = await fetch(url);
          const res = await response.json();
          renderMovies(res);
        } catch (error) {
          console.log(error);
          container.innerHTML = `<div class="error-msg">⚠️ Lỗi: ${error.message}. <br> Vui lòng thử lại.</div>`;
        } finally {
          toggleControls(false); // Enable buttons
        }
      };

      const renderMovies = (res) => {
        if (!res.data || !res.data.items || res.data.items.length === 0) {
          container.innerHTML = `<div class="error-msg">Không có dữ liệu</div>`;
          return;
        }
        const imageDomain = res.data.APP_DOMAIN_CDN_IMAGE;
        const movies = res.data.items;
        if (movies.length === 0) {
          container.innerHTML = `Không có dữ liệu`;
          return;
        }
        const totalItemsPerPage = res.data.params.pagination.totalItemsPerPage;
        const totalItems = res.data.params.pagination.totalItems;
        totalPagesCount = Math.ceil(totalItems / totalItemsPerPage);
        pageInput.max = totalPagesCount;
        totalPages.textContent = ` / ${totalPagesCount}`;
        btnPrev.disabled = params.page <= 1;
        btnNext.disabled = params.page >= totalPagesCount;
        const htmlString = movies
          .map((movie) => {
            const thumbUrl = `${imageDomain}/uploads/movies/${movie.thumb_url}`;
            return `
                    <div class="movie">
                        <div class="movie__img">
                            <img src="${thumbUrl}" alt="${movie.name}" loading="lazy">
                        </div>
                        <h1 class="movie__name">${movie.name}</h1>
                        <h2 class="movie__origin-name">${movie.origin_name}</h2>
                    </div>
                `;
          })
          .join("");
        container.innerHTML = htmlString;
      };
      btnPrev.addEventListener("click", () => {
        if (params.page > 1) {
          params.page--;
          pageInput.value = params.page;
          fetchMovies("hoat-hinh", params);
        }
      });

      btnNext.addEventListener("click", () => {
        if (params.page < totalPagesCount) {
          params.page++;
          pageInput.value = params.page;
          fetchMovies("hoat-hinh", params);
        }
      });

      pageInput.addEventListener("change", () => {
        let newVal = parseInt(pageInput.value);
        if (isNaN(newVal) || newVal < 1) newVal = 1;
        if (newVal > totalPagesCount) newVal = totalPagesCount;
        params.page = newVal;
        pageInput.value = newVal;
        fetchMovies("hoat-hinh", params);
      });

      fetchMovies("hoat-hinh", params);
    </script>
  </body>
</html>
